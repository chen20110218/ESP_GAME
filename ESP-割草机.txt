local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local GuiService = game:GetService("GuiService")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ColorChangingText"
screenGui.ResetOnSpawn = false
screenGui.DisplayOrder = 999
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local textLabel = Instance.new("TextLabel")
textLabel.Size = UDim2.new(1, 0, 1, 0)
textLabel.Position = UDim2.new(0, 0, 0, 0)
textLabel.BackgroundTransparency = 1
textLabel.Text = "üê¶Ê¨¢Ëøé‰ΩøÁî®NYÔºåÊ≠£Âú®‰∏∫ÊÇ®ÂºÄÂêØrakeËÑöÊú¨üê¶"
textLabel.Font = Enum.Font.SourceSansBold
textLabel.TextSize = 36
textLabel.TextColor3 = Color3.new(1, 1, 1)
textLabel.TextStrokeTransparency = 0.5
textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
textLabel.ZIndex = 10
textLabel.Parent = screenGui

textLabel.AnchorPoint = Vector2.new(0.5, 0.5)
textLabel.Position = UDim2.new(0.5, 0, 0.5, 0)

local authorLabel = Instance.new("TextLabel")
authorLabel.Size = UDim2.new(0, 400, 0, 120)
authorLabel.Position = UDim2.new(1, -410, 0, 10)
authorLabel.BackgroundTransparency = 1
authorLabel.Text = "‰ΩúËÄÖ:NuoYa"
authorLabel.Font = Enum.Font.SourceSansBold
authorLabel.TextSize = 72
authorLabel.TextColor3 = Color3.new(1, 1, 1)
authorLabel.TextStrokeTransparency = 0.5
authorLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
authorLabel.ZIndex = 10
authorLabel.Parent = screenGui

authorLabel.AnchorPoint = Vector2.new(1, 0)
authorLabel.Position = UDim2.new(1, -10, 0, 10)

local function changeColor()
    local time = 0
    local duration = 5
    
    while time < duration do
        local hue = (tick() * 24) % 360
        local color = Color3.fromHSV(hue/360, 1, 1)
        textLabel.TextColor3 = color
        authorLabel.TextColor3 = color
        wait(0.05)
        time = time + 0.05
    end
    
    screenGui:Destroy()
end

coroutine.wrap(changeColor)()
local waitTime = 5
local startTime = tick()

print("‚è≥ ËÑöÊú¨Â∞ÜÂú® "..waitTime.." ÁßíÂêéÂºÄÂßãÊâßË°å...")

while tick() - startTime < waitTime do
    -- ÊØèÈöî1ÁßíÊâìÂç∞‰∏ÄÊ¨°Ââ©‰ΩôÊó∂Èó¥
    local remaining = math.floor(waitTime - (tick() - startTime))
    if remaining ~= lastRemaining then
        print("üïí Ââ©‰ΩôÊó∂Èó¥: "..remaining.."Áßí")
        lastRemaining = remaining
    end
    wait(0.1)
end

print("‚úÖ Á≠âÂæÖÁªìÊùüÔºåÂºÄÂßãÊâßË°å‰∏ªËÑöÊú¨...")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local TweenService = game:GetService("TweenService")

-- ===== ESP ÈÖçÁΩÆÂå∫Âüü =====
local SETTINGS = {
    ENEMY_TAGS = {"Rake", "Monster", "Enemy"},
    ENEMY_COLOR = Color3.fromRGB(255, 50, 50),
    
    PLAYER_COLOR = Color3.fromRGB(50, 150, 255),
    TEAM_COLOR = Color3.fromRGB(50, 255, 100),
    
    SHOW_HEALTH = true,
    SHOW_DISTANCE = true,
    SHOW_TRACER = true,
    TRACER_COLOR = Color3.fromRGB(0, 150, 255),
    ENEMY_TRACER_COLOR = Color3.fromRGB(255, 50, 50),
    TRACER_THICKNESS = 0.1,
    
    MAX_DISTANCE = 1000,
    HEALTH_TEXT_SIZE = 16,
    DISTANCE_TEXT_SIZE = 14,
    NAME_TEXT_SIZE = 18,
    UPDATE_RATE = 0.005,
    
    SCAN_INTERVAL = 5,
    TRACER_FOR_ENEMIES = true,
    
    HIGHLIGHT_DISABLE_DISTANCE = 7  
}

local espCache = {}
local lastScanTime = 0

-- Áã¨Á´ãÁöÑESPÂºÄÂÖ≥Áä∂ÊÄÅ
local playerEspEnabled = true
local enemyEspEnabled = true
local trashEspEnabled = true

-- Ê£ÄÊü•ÊòØÂê¶Â∫îËØ•ÊòæÁ§∫ESP
local function shouldShowESP(target, data)
    if not target.Parent then return false end
    
    -- Ê£ÄÊü•ÊòØÂê¶ÊòØÊïå‰∫∫
    local isEnemy = false
    for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
        if target.Name:find(tag) or target:FindFirstChild(tag) then
            isEnemy = true
            break
        end
    end
    
    -- Ê£ÄÊü•ÊòØÂê¶ÊòØÈòüÂèã
    local isTeammate = false
    if not isEnemy and target:FindFirstChild("Team") then
        if LocalPlayer.Team and target.Team == LocalPlayer.Team then
            isTeammate = true
        end
    end
    
    -- Ê†πÊçÆÁ±ªÂûãÂíåÂºÄÂÖ≥Áä∂ÊÄÅÂÜ≥ÂÆöÊòØÂê¶ÊòæÁ§∫
    if isEnemy then
        return enemyEspEnabled
    elseif isTeammate then
        return playerEspEnabled
    else
        return playerEspEnabled
    end
end

local function createESP(target)
    if not target or not target:FindFirstChild("HumanoidRootPart") then return end
    
    if espCache[target] then return end
    
    local isEnemy = false
    local isTeammate = false
    local espColor = SETTINGS.PLAYER_COLOR
    
    for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
        if target.Name:find(tag) or target:FindFirstChild(tag) then
            isEnemy = true
            espColor = SETTINGS.ENEMY_COLOR
            break
        end
    end
    
    if not isEnemy and target:FindFirstChild("Team") then
        if LocalPlayer.Team and target.Team == LocalPlayer.Team then
            isTeammate = true
            espColor = SETTINGS.TEAM_COLOR
        end
    end
    
    local highlight = Instance.new("Highlight")
    highlight.Name = "AdvancedESP_Highlight"
    highlight.FillColor = espColor
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.FillTransparency = 0.3
    highlight.OutlineTransparency = 0
    highlight.Parent = target
    
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "AdvancedESP_Billboard"
    billboard.Adornee = target.HumanoidRootPart
    billboard.Size = UDim2.new(0, 150, 0, 60)
    billboard.StudsOffset = Vector3.new(0, 3.5, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = target
    
    local distanceText = Instance.new("TextLabel")
    distanceText.Name = "ESP_Distance"
    distanceText.Size = UDim2.new(1, 0, 0.3, 0)
    distanceText.Position = UDim2.new(0, 0, 0, 0)
    distanceText.BackgroundTransparency = 1
    distanceText.TextColor3 = Color3.fromRGB(200, 200, 255)
    distanceText.TextStrokeTransparency = 0.5
    distanceText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    distanceText.TextSize = SETTINGS.DISTANCE_TEXT_SIZE
    distanceText.Font = Enum.Font.SourceSansBold
    distanceText.TextXAlignment = Enum.TextXAlignment.Center
    distanceText.Parent = billboard
    
    local healthText = Instance.new("TextLabel")
    healthText.Name = "ESP_Health"
    healthText.Size = UDim2.new(1, 0, 0.4, 0)
    healthText.Position = UDim2.new(0, 0, 0.3, 0)
    healthText.BackgroundTransparency = 1
    healthText.TextColor3 = Color3.fromRGB(255, 255, 255)
    healthText.TextStrokeTransparency = 0.5
    healthText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    healthText.TextSize = SETTINGS.HEALTH_TEXT_SIZE
    healthText.Font = Enum.Font.SourceSansBold
    healthText.TextXAlignment = Enum.TextXAlignment.Center
    healthText.Parent = billboard
    
    local nameText = Instance.new("TextLabel")
    nameText.Name = "ESP_Name"
    nameText.Size = UDim2.new(1, 0, 0.3, 0)
    nameText.Position = UDim2.new(0, 0, 0.7, 0)
    nameText.BackgroundTransparency = 1
    nameText.TextColor3 = espColor
    nameText.TextStrokeTransparency = 0.5
    nameText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    nameText.TextSize = SETTINGS.NAME_TEXT_SIZE
    nameText.Font = Enum.Font.SourceSansBold
    nameText.TextXAlignment = Enum.TextXAlignment.Center
    nameText.Parent = billboard
    
    local tracer
    if SETTINGS.SHOW_TRACER and (not isEnemy or SETTINGS.TRACER_FOR_ENEMIES) then
        local startAttachment = Instance.new("Attachment")
        startAttachment.Name = "TracerStart"
        startAttachment.Parent = workspace.CurrentCamera
        
        local endAttachment = Instance.new("Attachment")
        endAttachment.Name = "TracerEnd"
        endAttachment.Parent = target.HumanoidRootPart
        
        tracer = Instance.new("Beam")
        tracer.Name = "ESP_Tracer"
        tracer.Attachment0 = startAttachment
        tracer.Attachment1 = endAttachment
        tracer.Color = ColorSequence.new(isEnemy and SETTINGS.ENEMY_TRACER_COLOR or SETTINGS.TRACER_COLOR)
        tracer.Width0 = SETTINGS.TRACER_THICKNESS
        tracer.Width1 = SETTINGS.TRACER_THICKNESS * 0.8
        tracer.LightEmission = 0.8
        tracer.Transparency = NumberSequence.new(0.5)
        tracer.FaceCamera = true
        tracer.Parent = target.HumanoidRootPart
    end
    
    espCache[target] = {
        highlight = highlight,
        billboard = billboard,
        tracer = tracer,
        humanoid = target:FindFirstChildOfClass("Humanoid"),
        rootPart = target.HumanoidRootPart,
        startAttachment = tracer and tracer.Attachment0,
        endAttachment = tracer and tracer.Attachment1,
        isEnemy = isEnemy,
        isTeammate = isTeammate
    }
end

local function fullScan()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            createESP(player.Character)
        end
    end
    
    for _, descendant in ipairs(workspace:GetDescendants()) do
        if descendant:IsA("Model") and descendant:FindFirstChild("HumanoidRootPart") then
            for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
                if descendant.Name:find(tag) or descendant:FindFirstChild(tag) then
                    createESP(descendant)
                    break
                end
            end
        end
    end
end

-- ===== ESP Êõ¥Êñ∞Âæ™ÁéØ =====
local lastUpdate = 0

RunService.Heartbeat:Connect(function(deltaTime)
    lastUpdate = lastUpdate + deltaTime
    lastScanTime = lastScanTime + deltaTime
    
    if lastScanTime >= SETTINGS.SCAN_INTERVAL then
        lastScanTime = 0
        fullScan()
    end
    
    if lastUpdate < SETTINGS.UPDATE_RATE then return end
    lastUpdate = 0
    
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
    local localRoot = LocalPlayer.Character.HumanoidRootPart
    
    for target, data in pairs(espCache) do
        if not target.Parent then
            if data.highlight then data.highlight:Destroy() end
            if data.billboard then data.billboard:Destroy() end
            if data.tracer then data.tracer:Destroy() end
            espCache[target] = nil
        else
            local distance = (data.rootPart.Position - localRoot.Position).Magnitude
            local distanceInMeters = distance / 3.571  -- ËΩ¨Êç¢‰∏∫Á±≥
            local shouldShow = distance <= SETTINGS.MAX_DISTANCE and shouldShowESP(target, data)
            
            -- ÊòæÁ§∫/ÈöêËóèBillboardÂíåTracer
            data.billboard.Enabled = shouldShow
            if data.tracer then
                data.tracer.Enabled = shouldShow
                if data.startAttachment then
                    data.startAttachment.WorldPosition = localRoot.Position - Vector3.new(0, 1.5, 0)
                end
            end
            
            -- ===== ‰ºòÂåñÔºöË∑ùÁ¶ªÂ∞è‰∫é7Á±≥Êó∂ÂÖ≥Èó≠È´ò‰∫Æ =====
            if shouldShow then
                -- ÂΩìË∑ùÁ¶ªÂ∞è‰∫éÈÖçÁΩÆÂÄºÊó∂ÂÖ≥Èó≠È´ò‰∫Æ
                if distanceInMeters < SETTINGS.HIGHLIGHT_DISABLE_DISTANCE then
                    data.highlight.Enabled = false
                else
                    data.highlight.Enabled = true
                end
            else
                data.highlight.Enabled = false
            end
            
            -- Êõ¥Êñ∞ÊñáÊú¨‰ø°ÊÅØ
            if shouldShow then
                if SETTINGS.SHOW_DISTANCE then
                    data.billboard.ESP_Distance.Text = string.format("%.1fm", distanceInMeters)
                else
                    data.billboard.ESP_Distance.Text = ""
                end
                
                if SETTINGS.SHOW_HEALTH and data.humanoid then
                    data.billboard.ESP_Health.Text = string.format("HP: %d/%d", 
                        math.floor(data.humanoid.Health), 
                        math.floor(data.humanoid.MaxHealth))
                else
                    data.billboard.ESP_Health.Text = ""
                end
                
                data.billboard.ESP_Name.Text = target.Name
            end
        end
    end
end)

-- ===== ESP ÂàùÂßãÂåñÂíå‰∫ã‰ª∂ÁõëÂê¨ =====
fullScan()

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        createESP(character)
    end)
end)

workspace.DescendantAdded:Connect(function(descendant)
    if descendant:IsA("Model") and descendant:FindFirstChild("HumanoidRootPart") then
        for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
            if descendant.Name:find(tag) or descendant:FindFirstChild(tag) then
                createESP(descendant)
                break
            end
        end
    end
end)

LocalPlayer.CharacterRemoving:Connect(function()
    for _, data in pairs(espCache) do
        if data.highlight then data.highlight:Destroy() end
        if data.billboard then data.billboard:Destroy() end
        if data.tracer then data.tracer:Destroy() end
    end
    espCache = {}
end)

-- ===== Â§úËßÜËÑöÊú¨ =====
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")

-- ‰øùÂ≠òÂéüÂßãËÆæÁΩÆ
local originalBrightness = Lighting.Brightness
local originalExposureCompensation = Lighting.ExposureCompensation
local originalClockTime = Lighting.ClockTime
local originalFogEnd = Lighting.FogEnd

-- Â§úËßÜÁä∂ÊÄÅÂèòÈáè - ‰øÆÊîπÔºöÈªòËÆ§ÂºÄÂêØÂ§úËßÜÂäüËÉΩ
local nightVisionEnabled = true
local nightVisionConnection

-- ÂàõÂª∫ÈÄÇÂ∫¶‰∫ÆÂ∫¶Â¢ûÂº∫ÊïàÊûú
local function enableNightVision()
    -- ÈÄÇÂ∫¶ÊèêÈ´ò‰∫ÆÂ∫¶ÂíåÊõùÂÖâÂ∫¶
    Lighting.Brightness = 1.8  -- ÈÄÇÂ∫¶ÊèêÈ´òÊï¥‰Ωì‰∫ÆÂ∫¶
    Lighting.ExposureCompensation = 1.4  -- ÂÜçÊ¨°ÂæÆË∞ÉÊõùÂÖâË°•ÂÅøÔºà‰ªé1.45Èôç‰ΩéÂà∞1.4Ôºâ
    
    -- Âº∫Âà∂ËÆæÁΩÆ‰∏∫ÁôΩÂ§©Êó∂Èó¥
    Lighting.ClockTime = 12  -- ‰∏≠Âçà12ÁÇπÔºåÈÄÇ‰∏≠ÁöÑÊó•ÁÖßÊó∂Èó¥
    
    -- ÈÄÇÂ∫¶Â¢ûÂä†ÈõæÊïàË∑ùÁ¶ª
    if Lighting.FogEnd < 5000 then
        Lighting.FogEnd = 5000  -- ÈÄÇÂ∫¶Â¢ûÂä†ÈõæÊïàÁªìÊùüË∑ùÁ¶ª
    end
    
    -- Ê∑ªÂä†ËΩªÂæÆÁöÑBloomÊïàÊûú
    if not Lighting:FindFirstChild("NightVisionBloom") then
        local bloom = Instance.new("BloomEffect")
        bloom.Name = "NightVisionBloom"
        bloom.Intensity = 0.1   -- ËΩªÂæÆÂÖâÊôïÊïàÊûú
        bloom.Threshold = 0.85  -- ÊèêÈ´òÈòàÂÄºÔºåÂáèÂ∞ëÂÖâÊôïËåÉÂõ¥
        bloom.Size = 16         -- ÈÄÇ‰∏≠ÁöÑÂÖâÊôïÂ∞∫ÂØ∏
        bloom.Parent = Lighting
    end
    
    -- Ê∑ªÂä†ËΩªÂæÆÁöÑÈ¢úËâ≤Ê†°Ê≠£ÊïàÊûú
    if not Lighting:FindFirstChild("NightVisionColorCorrection") then
        local colorCorrection = Instance.new("ColorCorrectionEffect")
        colorCorrection.Name = "NightVisionColorCorrection"
        colorCorrection.Brightness = 0.12  -- ËΩªÂæÆÊèêÈ´ò‰∫ÆÂ∫¶
        colorCorrection.Contrast = 0.2     -- ÈÄÇÂ∫¶Â¢ûÂº∫ÂØπÊØîÂ∫¶
        colorCorrection.Saturation = 0     -- ÂÆåÂÖ®‰øùÊåÅÂéüÂßãÈ¢úËâ≤
        colorCorrection.TintColor = Color3.fromRGB(255, 255, 255)  -- Á∫ØÁôΩËâ≤Ôºå‰∏çÊîπÂèòËâ≤Ë∞É
        colorCorrection.Parent = Lighting
    end
    
    -- ÂêØÂä®Êõ¥Êñ∞Âæ™ÁéØ
    if nightVisionConnection then
        nightVisionConnection:Disconnect()
    end
    
    nightVisionConnection = RunService.RenderStepped:Connect(function()
        -- Á°Æ‰øù‰∫ÆÂ∫¶ÂíåÊõùÂÖâËÆæÁΩÆ‰∏ç‰ºöË¢´ÂÖ∂‰ªñËÑöÊú¨Ë¶ÜÁõñ
        if Lighting.Brightness < 1.6 then
            Lighting.Brightness = 1.8
        end
        
        if Lighting.ExposureCompensation < 1.3 then
            Lighting.ExposureCompensation = 1.4  -- Á°Æ‰øùÊõùÂÖâË°•ÂÅø‰øùÊåÅÂú®1.4
        end
        
        -- Á°Æ‰øùÊó∂Èó¥‰øùÊåÅÂú®ÁôΩÂ§©
        if Lighting.ClockTime < 8 or Lighting.ClockTime > 16 then
            Lighting.ClockTime = 12  -- ‰∏≠Âçà12ÁÇπ
        end
        
        -- Á°Æ‰øùÈõæÊïàË∑ùÁ¶ªË∂≥Â§üËøú
        if Lighting.FogEnd < 5000 then
            Lighting.FogEnd = 5000
        end
        
        -- Á°Æ‰øùBloomÊïàÊûúÂ≠òÂú®
        if not Lighting:FindFirstChild("NightVisionBloom") then
            local bloom = Instance.new("BloomEffect")
            bloom.Name = "NightVisionBloom"
            bloom.Intensity = 0.1
            bloom.Threshold = 0.85
            bloom.Size = 16
            bloom.Parent = Lighting
        end
        
        -- Á°Æ‰øùÈ¢úËâ≤Ê†°Ê≠£ÊïàÊûúÂ≠òÂú®
        if not Lighting:FindFirstChild("NightVisionColorCorrection") then
            local colorCorrection = Instance.new("ColorCorrectionEffect")
            colorCorrection.Name = "NightVisionColorCorrection"
            colorCorrection.Brightness = 0.12
            colorCorrection.Contrast = 0.2
            colorCorrection.Saturation = 0
            colorCorrection.TintColor = Color3.fromRGB(255, 255, 255)
            colorCorrection.Parent = Lighting
        end
    end)
end

-- Ê∏ÖÁêÜÂáΩÊï∞
local function disableNightVision()
    if nightVisionConnection then
        nightVisionConnection:Disconnect()
        nightVisionConnection = nil
    end
    
    -- ÊÅ¢Â§çÂéüÂßãËÆæÁΩÆ
    Lighting.Brightness = originalBrightness
    Lighting.ExposureCompensation = originalExposureCompensation
    Lighting.ClockTime = originalClockTime
    Lighting.FogEnd = originalFogEnd
    
    -- ÁßªÈô§Ê∑ªÂä†ÁöÑÊïàÊûú
    local bloom = Lighting:FindFirstChild("NightVisionBloom")
    if bloom then
        bloom:Destroy()
    end
    
    local colorCorrection = Lighting:FindFirstChild("NightVisionColorCorrection")
    if colorCorrection then
        colorCorrection:Destroy()
    end
end

-- Â§úËßÜÂàáÊç¢ÂáΩÊï∞
local function toggleNightVision()
    nightVisionEnabled = not nightVisionEnabled
    
    if nightVisionEnabled then
        enableNightVision()
        print("Â§úËßÜÂäüËÉΩÂ∑≤ÂêØÁî®")
    else
        disableNightVision()
        print("Â§úËßÜÂäüËÉΩÂ∑≤Á¶ÅÁî®")
    end
    
    return nightVisionEnabled
end

-- Ê∏∏ÊàèÂÖ≥Èó≠Êó∂Ëá™Âä®Ê∏ÖÁêÜ
game:GetService("Players").LocalPlayer:GetPropertyChangedSignal("Parent"):Connect(function()
    if not game:GetService("Players").LocalPlayer.Parent then
        disableNightVision()
    end
end)

-- ===== È´òÁ∫ßÂ∫üÊñôÈÄèËßÜËÑöÊú¨ =====
-- ÊîØÊåÅÂÖ®ÂõæÊâ´Êèè„ÄÅË∑ùÁ¶ªÊòæÁ§∫ÂíåÊñáÂ≠óÊ†áÁ≠æ

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- ÈÖçÁΩÆÂèÇÊï∞
local config = {
    maxDistance = 2000, -- ÊúÄÂ§ßÊ£ÄÊµãË∑ùÁ¶ª(stud)
    highlightColor = Color3.fromRGB(0, 255, 0), -- È´ò‰∫ÆÈ¢úËâ≤
    highlightTransparency = 0.3, -- ÈÄèÊòéÂ∫¶
    scanInterval = 1, -- ÂÖ®ÂõæÊâ´ÊèèÈó¥Èöî(Áßí)
    updateInterval = 0.1, -- Êõ¥Êñ∞Èó¥Èöî(Áßí)
    labelColor = Color3.fromRGB(255, 255, 255), -- Ê†áÁ≠æÈ¢úËâ≤
    labelSize = 15, -- Ê†áÁ≠æÂ≠ó‰ΩìÂ§ßÂ∞è
    maxLabels = 50, -- ÊúÄÂ§ßÊòæÁ§∫Ê†áÁ≠æÊï∞Èáè
    tagPrefix = "[Â∫üÊñô]", -- Ê†áÁ≠æÂâçÁºÄ
    scanKey = Enum.KeyCode.T -- ÂÖ®ÂõæÊâ´ÊèèÂø´Êç∑ÈîÆ
}

-- Êú¨Âú∞ÂèòÈáè
local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local camera = workspace.CurrentCamera

-- Â≠òÂÇ®Â∑≤È´ò‰∫ÆÁöÑÂ∫üÊñô
local highlightedTrash = {}
local trashCache = {}
local lastScanTimeTrash = 0
local scanning = false

-- ËΩ¨Êç¢stud‰∏∫Á±≥ÁöÑÂáΩÊï∞
local function studsToMeters(studs)
    return studs / 3.571
end

-- ÂàõÂª∫Ê†áÁ≠æÂáΩÊï∞
local function createLabel(trashPart, distanceInStuds)
    if not trashPart:FindFirstChild("TrashLabel") then
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "TrashLabel"
        billboard.AlwaysOnTop = true
        billboard.Size = UDim2.new(0, 200, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.Adornee = trashPart
        billboard.MaxDistance = config.maxDistance
        
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = string.format("%s\n%.1fÁ±≥", config.tagPrefix, studsToMeters(distanceInStuds))
        textLabel.TextColor3 = config.labelColor
        textLabel.TextSize = config.labelSize
        textLabel.Font = Enum.Font.SourceSansBold
        textLabel.TextStrokeTransparency = 0.5
        textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
        
        textLabel.Parent = billboard
        billboard.Parent = trashPart
        
        return billboard
    end
    return trashPart:FindFirstChild("TrashLabel")
end

-- Êõ¥Êñ∞Ê†áÁ≠æË∑ùÁ¶ª
local function updateLabel(trashPart, distanceInStuds)
    local label = trashPart:FindFirstChild("TrashLabel")
    if label then
        label.TextLabel.Text = string.format("%s\n%.1fÁ±≥", config.tagPrefix, studsToMeters(distanceInStuds))
        
        -- Ê†πÊçÆË∑ùÁ¶ªË∞ÉÊï¥Ê†áÁ≠æÂ§ßÂ∞è
        local scale = math.clamp(1 - (distanceInStuds / config.maxDistance) * 0.5, 0.5, 1)
        label.TextLabel.TextSize = config.labelSize * scale
    end
end

-- È´ò‰∫ÆÂ∫üÊñôÁöÑÂáΩÊï∞
local function highlightTrash(trashPart)
    if not highlightedTrash[trashPart] then
        local highlight = Instance.new("Highlight")
        highlight.Name = "TrashHighlight"
        highlight.FillColor = config.highlightColor
        highlight.FillTransparency = config.highlightTransparency
        highlight.OutlineColor = config.highlightColor
        highlight.OutlineTransparency = 0
        highlight.Adornee = trashPart
        highlight.Parent = trashPart
        
        highlightedTrash[trashPart] = highlight
    end
end

-- ÂÖ®ÂõæÊâ´ÊèèÂ∫üÊñô
local function fullScanTrash()
    if scanning or not trashEspEnabled then return end
    scanning = true
    
    local startTime = os.clock()
    trashCache = {}
    
    -- Êâ©Â±ïÊêúÁ¥¢Êù°‰ª∂
    local trashKeywords = {"trash", "scrap", "junk", "waste", "debris", "rubbish", "garbage", "Â∫üÊñô", "ÂûÉÂúæ"}
    
    -- Êâ´ÊèèÂ∑•‰ΩúÂå∫
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") then
            local lowerName = obj.Name:lower()
            for _, keyword in ipairs(trashKeywords) do
                if lowerName:find(keyword) then
                    table.insert(trashCache, obj)
                    break
                end
            end
        end
    end
    
    -- Êâ´ÊèèÊ®°Âûã
    for _, model in ipairs(workspace:GetChildren()) do
        if model:IsA("Model") then
            local lowerName = model.Name:lower()
            for _, keyword in ipairs(trashKeywords) do
                if lowerName:find(keyword) then
                    for _, part in ipairs(model:GetDescendants()) do
                        if part:IsA("BasePart") then
                            table.insert(trashCache, part)
                        end
                    end
                    break
                end
            end
        end
    end
    
    scanning = false
    lastScanTimeTrash = os.clock()
    print(string.format("ÂÖ®ÂõæÊâ´ÊèèÂÆåÊàêÔºåÊâæÂà∞ %d ‰∏™Â∫üÊñôÔºåËÄóÊó∂ %.2f Áßí", #trashCache, os.clock() - startTime))
end

-- Ê∏ÖÈô§‰∏çÂÜçÈúÄË¶ÅÁöÑÂ∫üÊñôÈ´ò‰∫Æ
local function cleanUpHighlights(currentTrash)
    for trashPart, highlight in pairs(highlightedTrash) do
        if not table.find(currentTrash, trashPart) then
            if highlight then highlight:Destroy() end
            local label = trashPart:FindFirstChild("TrashLabel")
            if label then label:Destroy() end
            highlightedTrash[trashPart] = nil
        end
    end
end

-- Êõ¥Êñ∞ÈôÑËøëÁöÑÂ∫üÊñôÊòæÁ§∫
local function updateNearbyTrash()
    if not trashEspEnabled then
        cleanUpHighlights({})
        return
    end
    
    if not humanoidRootPart or not humanoidRootPart:IsDescendantOf(workspace) then
        return
    end
    
    local currentTime = os.clock()
    if currentTime - lastScanTimeTrash > config.scanInterval then
        task.spawn(fullScanTrash)
    end
    
    local nearbyTrash = {}
    local playerPos = humanoidRootPart.Position
    
    -- ÊåâË∑ùÁ¶ªÊéíÂ∫è
    table.sort(trashCache, function(a, b)
        return (playerPos - a.Position).Magnitude < (playerPos - b.Position).Magnitude
    end)
    
    -- Âè™ÊòæÁ§∫ÊúÄËøëÁöÑmaxLabels‰∏™Â∫üÊñô
    local displayCount = 0
    for _, trashPart in ipairs(trashCache) do
        if displayCount >= config.maxLabels then break end
        
        local distance = (playerPos - trashPart.Position).Magnitude
        if distance <= config.maxDistance then
            table.insert(nearbyTrash, trashPart)
            highlightTrash(trashPart)
            local label = createLabel(trashPart, distance)
            updateLabel(trashPart, distance)
            displayCount += 1
        end
    end
    
    cleanUpHighlights(nearbyTrash)
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == config.scanKey and trashEspEnabled then
        fullScanTrash()
    end
end)

RunService.Heartbeat:Connect(function()
    updateNearbyTrash()
end)

LocalPlayer.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
end)

task.spawn(fullScanTrash)

print("È´òÁ∫ßÂ∫üÊñôÈÄèËßÜËÑöÊú¨Â∑≤ÊøÄÊ¥ª")
print(string.format("Êåâ %s ÈîÆÊâãÂä®Ëß¶ÂèëÂÖ®ÂõæÊâ´Êèè", config.scanKey.Name))

-- ===== Áé©ÂÆ∂Âä†ÈÄüËÑöÊú¨ =====
local speedMultiplier = 2  -- Âõ∫ÂÆöÈÄüÂ∫¶ÂÄçÂ¢ûÁ≥ªÊï∞
local defaultWalkSpeed = 16  -- ÈªòËÆ§ÈÄüÂ∫¶
local isSpeeding = true  -- ÈªòËÆ§ÂºÄÂêØÂä†ÈÄü
local speedConnection
local currentHumanoid

-- ÂÆâÂÖ®ËÆæÁΩÆÈÄüÂ∫¶ÁöÑÂáΩÊï∞
local function setWalkSpeedSafe(humanoid, speed)
    if humanoid and humanoid.Parent and humanoid:IsA("Humanoid") then
        pcall(function()
            humanoid.WalkSpeed = speed
        end)
    end
end

-- ËÆæÁΩÆÈÄüÂ∫¶Â∫îÁî®
local function setupSpeedApplication()
    if speedConnection then
        speedConnection:Disconnect()
        speedConnection = nil
    end
    
    -- Ê∏ÖÈô§ÂΩìÂâçhumanoidÂºïÁî®
    currentHumanoid = nil
    
    -- Ëé∑ÂèñÂΩìÂâçËßíËâ≤ÁöÑhumanoid
    if LocalPlayer.Character then
        currentHumanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if currentHumanoid then
            -- ÈáçÁΩÆ‰∏∫ÈªòËÆ§ÈÄüÂ∫¶
            setWalkSpeedSafe(currentHumanoid, defaultWalkSpeed)
            
            -- Â¶ÇÊûúÂä†ÈÄüÂºÄÂêØÔºåÂàôÂ∫îÁî®Âä†ÈÄü
            if isSpeeding then
                setWalkSpeedSafe(currentHumanoid, defaultWalkSpeed * speedMultiplier)
            end
        end
    end
    
    -- ËÆæÁΩÆÊåÅÁª≠ÁõëÊéß
    speedConnection = RunService.Heartbeat:Connect(function()
        if not currentHumanoid or not currentHumanoid.Parent then
            -- ÈáçÊñ∞Ëé∑ÂèñhumanoidÂºïÁî®
            if LocalPlayer.Character then
                currentHumanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                if currentHumanoid and isSpeeding then
                    setWalkSpeedSafe(currentHumanoid, defaultWalkSpeed * speedMultiplier)
                end
            end
        elseif isSpeeding then
            -- ÊåÅÁª≠Â∫îÁî®Âä†ÈÄüÊïàÊûú
            setWalkSpeedSafe(currentHumanoid, defaultWalkSpeed * speedMultiplier)
        end
    end)
end

-- ÂàùÂßãÂåñÈÄüÂ∫¶Â∫îÁî®
setupSpeedApplication()

-- ËßíËâ≤ÈáçÊñ∞ÁîüÊàêÊó∂ÈáçÁΩÆÈÄüÂ∫¶ÂíåÂºïÁî®
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    -- Á≠âÂæÖhumanoidÂä†ËΩΩÂÆåÊàê
    local humanoid = newCharacter:WaitForChild("Humanoid")
    
    -- Êõ¥Êñ∞ÈªòËÆ§ÈÄüÂ∫¶‰∏∫Êñ∞ËßíËâ≤ÁöÑÂÆûÈôÖÈÄüÂ∫¶
    defaultWalkSpeed = humanoid.WalkSpeed
    
    -- ÈáçÊñ∞ËÆæÁΩÆÈÄüÂ∫¶Â∫îÁî®
    setupSpeedApplication()
    
    print("ËßíËâ≤ÈáçÁîüÔºåÈÄüÂ∫¶Â∑≤ÈáçÁΩÆ")
end)

-- ËßíËâ≤ÁßªÈô§Êó∂Ê∏ÖÁêÜ
LocalPlayer.CharacterRemoving:Connect(function()
    if speedConnection then
        speedConnection:Disconnect()
        speedConnection = nil
    end
    currentHumanoid = nil
end)

-- Ê∏∏ÊàèÈÄÄÂá∫Êó∂ÈáçÁΩÆÈÄüÂ∫¶
Players.PlayerRemoving:Connect(function(leavingPlayer)
    if leavingPlayer == LocalPlayer then
        if speedConnection then
            speedConnection:Disconnect()
            speedConnection = nil
        end
        
        local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if humanoid and humanoid.Parent then
            setWalkSpeedSafe(humanoid, defaultWalkSpeed)
        end
    end
end)

-- ===== ÂúÜÂΩ¢ÊÇ¨ÊµÆÁ™ó‰∏éÂä®ÁîªÊåâÈíÆ =====
local function createCircularMenu()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "CircularMenuGUI"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    
    -- ÂúÜÂΩ¢‰∏ªÊåâÈíÆ - Â±èÂπïÊ≠£Âè≥Ëæπ‰∏≠Èó¥‰ΩçÁΩÆ
    local mainButton = Instance.new("ImageButton")
    mainButton.Name = "MainButton"
    mainButton.Size = UDim2.new(0, 50, 0, 50)
    mainButton.Position = UDim2.new(1, -60, 0.5, -25)
    mainButton.AnchorPoint = Vector2.new(0, 0.5)
    mainButton.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    mainButton.AutoButtonColor = true
    
    -- ÂúÜÂΩ¢Â§ñËßÇ
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = mainButton
    
    -- Ê∑ªÂä†NYÂõæÊ°à
    local nyLabel = Instance.new("TextLabel")
    nyLabel.Name = "NYLabel"
    nyLabel.Size = UDim2.new(1, 0, 1, 0)
    nyLabel.BackgroundTransparency = 1
    nyLabel.Text = "NY"
    nyLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
    nyLabel.TextSize = 20
    nyLabel.Font = Enum.Font.SourceSansBold
    nyLabel.Parent = mainButton
    
    -- ÂèëÂÖâÊïàÊûú
    local glow = Instance.new("UIStroke")
    glow.Name = "Glow"
    glow.Color = Color3.fromRGB(100, 150, 255)
    glow.Thickness = 2
    glow.Transparency = 0.5
    glow.Parent = mainButton
    
    mainButton.Parent = screenGui
    
    -- ÂäüËÉΩÊåâÈíÆÂÆπÂô®
    local buttonContainer = Instance.new("Frame")
    buttonContainer.Name = "ButtonContainer"
    buttonContainer.Size = UDim2.new(0, 0, 0, 0)
    buttonContainer.Position = UDim2.new(0.5, 0, 0.4, 0)
    buttonContainer.AnchorPoint = Vector2.new(0.5, 0.5)
    buttonContainer.BackgroundTransparency = 1
    buttonContainer.Visible = false
    buttonContainer.Parent = screenGui
    
    -- ÂàõÂª∫Áé©ÂÆ∂ESPÂºÄÂÖ≥ÊåâÈíÆ
    local playerEspButton = Instance.new("TextButton")
    playerEspButton.Name = "PlayerESPButton"
    playerEspButton.Size = UDim2.new(0, 120, 0, 30)
    playerEspButton.Position = UDim2.new(0, 0, 0, 0)
    playerEspButton.BackgroundColor3 = playerEspEnabled and Color3.fromRGB(50, 200, 80) or Color3.fromRGB(200, 50, 50)
    playerEspButton.Text = playerEspEnabled and "Áé©ÂÆ∂ESPÂºÄÂêØ" or "Áé©ÂÆ∂ESPÂÖ≥Èó≠"
    playerEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    playerEspButton.TextSize = 14
    playerEspButton.Font = Enum.Font.SourceSansBold
    playerEspButton.AutoButtonColor = true
    playerEspButton.Visible = false
    
    -- ÂúÜËßí
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0.2, 0)
    buttonCorner.Parent = playerEspButton
    
    -- ÂàõÂª∫Êïå‰∫∫ESPÂºÄÂÖ≥ÊåâÈíÆ
    local enemyEspButton = Instance.new("TextButton")
    enemyEspButton.Name = "EnemyESPButton"
    enemyEspButton.Size = UDim2.new(0, 120, 0, 30)
    enemyEspButton.Position = UDim2.new(0, 0, 0, 0)
    enemyEspButton.BackgroundColor3 = enemyEspEnabled and Color3.fromRGB(200, 50, 50) or Color3.fromRGB(100, 100, 100)
    enemyEspButton.Text = enemyEspEnabled and "Êïå‰∫∫ESPÂºÄÂêØ" or "Êïå‰∫∫ESPÂÖ≥Èó≠"
    enemyEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    enemyEspButton.TextSize = 14
    enemyEspButton.Font = Enum.Font.SourceSansBold
    enemyEspButton.AutoButtonColor = true
    enemyEspButton.Visible = false
    
    local buttonCorner2 = Instance.new("UICorner")
    buttonCorner2.CornerRadius = UDim.new(0.2, 0)
    buttonCorner2.Parent = enemyEspButton
    
    -- ÂàõÂª∫Â∫üÊñôESPÂºÄÂÖ≥ÊåâÈíÆ
    local trashEspButton = Instance.new("TextButton")
    trashEspButton.Name = "TrashESPButton"
    trashEspButton.Size = UDim2.new(0, 120, 0, 30)
    trashEspButton.Position = UDim2.new(0, 0, 0, 0)
    trashEspButton.BackgroundColor3 = trashEspEnabled and Color3.fromRGB(50, 150, 255) or Color3.fromRGB(100, 100, 100)
    trashEspButton.Text = trashEspEnabled and "Â∫üÊñôESPÂºÄÂêØ" or "Â∫üÊñôESPÂÖ≥Èó≠"
    trashEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    trashEspButton.TextSize = 14
    trashEspButton.Font = Enum.Font.SourceSansBold
    trashEspButton.AutoButtonColor = true
    trashEspButton.Visible = false
    
    local buttonCorner3 = Instance.new("UICorner")
    buttonCorner3.CornerRadius = UDim.new(0.2, 0)
    buttonCorner3.Parent = trashEspButton
    
    -- ÂàõÂª∫Â§úËßÜÂºÄÂÖ≥ÊåâÈíÆ
    local nightVisionToggleButton = Instance.new("TextButton")
    nightVisionToggleButton.Name = "NightVisionToggleButton"
    nightVisionToggleButton.Size = UDim2.new(0, 120, 0, 30)
    nightVisionToggleButton.Position = UDim2.new(0, 0, 0, 0)
    nightVisionToggleButton.BackgroundColor3 = nightVisionEnabled and Color3.fromRGB(50, 200, 200) or Color3.fromRGB(100, 100, 150)
    nightVisionToggleButton.Text = nightVisionEnabled and "Â§úËßÜÂºÄÂêØ" or "Â§úËßÜÂÖ≥Èó≠"
    nightVisionToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    nightVisionToggleButton.TextSize = 14
    nightVisionToggleButton.Font = Enum.Font.SourceSansBold
    nightVisionToggleButton.AutoButtonColor = true
    nightVisionToggleButton.Visible = false
    
    local buttonCorner4 = Instance.new("UICorner")
    buttonCorner4.CornerRadius = UDim.new(0.2, 0)
    buttonCorner4.Parent = nightVisionToggleButton
    
    -- ËèúÂçïÁä∂ÊÄÅ
    local menuExpanded = false
    
    -- Â±ïÂºÄ/Êî∂Ëµ∑ËèúÂçïÁöÑÂáΩÊï∞
    local function toggleMenu()
        menuExpanded = not menuExpanded
        
        if menuExpanded then
            -- ÊòæÁ§∫ÂÆπÂô®
            buttonContainer.Visible = true
            
            -- Â±ïÂºÄÂÆπÂô®
            local expandTween = TweenService:Create(
                buttonContainer,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Size = UDim2.new(0, 150, 0, 140)}
            )
            expandTween:Play()
            
            -- ÊòæÁ§∫Âπ∂Âä®ÁîªÁßªÂä®ÊåâÈíÆ
            playerEspButton.Parent = buttonContainer
            enemyEspButton.Parent = buttonContainer
            trashEspButton.Parent = buttonContainer
            nightVisionToggleButton.Parent = buttonContainer
            
            playerEspButton.Visible = true
            enemyEspButton.Visible = true
            trashEspButton.Visible = true
            nightVisionToggleButton.Visible = true
            
            -- Áé©ÂÆ∂ESPÊåâÈíÆÂä®Áîª
            local playerEspTween = TweenService:Create(
                playerEspButton,
                TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
                {Position = UDim2.new(0, 15, 0, 10)}
            )
            playerEspTween:Play()
            
            -- Êïå‰∫∫ESPÊåâÈíÆÂä®Áîª
            local enemyEspTween = TweenService:Create(
                enemyEspButton,
                TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out, 0.1),
                {Position = UDim2.new(0, 15, 0, 50)}
            )
            enemyEspTween:Play()
            
            -- Â∫üÊñôESPÊåâÈíÆÂä®Áîª
            local trashEspTween = TweenService:Create(
                trashEspButton,
                TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out, 0.2),
                {Position = UDim2.new(0, 15, 0, 90)}
            )
            trashEspTween:Play()
            
            -- Â§úËßÜÊåâÈíÆÂä®Áîª
            local nightVisionTween = TweenService:Create(
                nightVisionToggleButton,
                TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out, 0.3),
                {Position = UDim2.new(0, 15, 0, 130)}
            )
            nightVisionTween:Play()
        else
            -- Êî∂Ëµ∑ÊåâÈíÆ
            local playerEspTween = TweenService:Create(
                playerEspButton,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Position = UDim2.new(0, 0, 0, 0)}
            )
            playerEspTween:Play()
            
            local enemyEspTween = TweenService:Create(
                enemyEspButton,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Position = UDim2.new(0, 0, 0, 0)}
            )
            enemyEspTween:Play()
            
            local trashEspTween = TweenService:Create(
                trashEspButton,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Position = UDim2.new(0, 0, 0, 0)}
            )
            trashEspTween:Play()
            
            local nightVisionTween = TweenService:Create(
                nightVisionToggleButton,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Position = UDim2.new(0, 0, 0, 0)}
            )
            nightVisionTween:Play()
            
            -- Âª∂ËøüÂêéÈöêËóèÂÆπÂô®
            task.delay(0.3, function()
                if not menuExpanded then
                    buttonContainer.Visible = false
                    playerEspButton.Visible = false
                    enemyEspButton.Visible = false
                    trashEspButton.Visible = false
                    nightVisionToggleButton.Visible = false
                    
                    -- Êî∂Ëµ∑ÂÆπÂô®
                    local collapseTween = TweenService:Create(
                        buttonContainer,
                        TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                        {Size = UDim2.new(0, 0, 0, 0)}
                    )
                    collapseTween:Play()
                end
            end)
        end
    end
    
    -- ‰∏ªÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
    mainButton.MouseButton1Click:Connect(toggleMenu)
    
    -- Áé©ÂÆ∂ESPÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
    playerEspButton.MouseButton1Click:Connect(function()
        playerEspEnabled = not playerEspEnabled
        
        playerEspButton.BackgroundColor3 = playerEspEnabled and Color3.fromRGB(50, 200, 80) or Color3.fromRGB(200, 50, 50)
        playerEspButton.Text = playerEspEnabled and "Áé©ÂÆ∂ESPÂºÄÂêØ" or "Áé©ÂÆ∂ESPÂÖ≥Èó≠"
        
        -- Êõ¥Êñ∞ÊâÄÊúâÁé©ÂÆ∂ESPÁöÑÊòæÁ§∫Áä∂ÊÄÅ
        for target, data in pairs(espCache) do
            if not data.isEnemy then
                local shouldShow = shouldShowESP(target, data)
                if data.highlight then
                    data.highlight.Enabled = shouldShow
                end
                if data.billboard then
                    data.billboard.Enabled = shouldShow
                end
                if data.tracer then
                    data.tracer.Enabled = shouldShow
                end
            end
        end
    end)
    
    -- Êïå‰∫∫ESPÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
    enemyEspButton.MouseButton1Click:Connect(function()
        enemyEspEnabled = not enemyEspEnabled
        
        enemyEspButton.BackgroundColor3 = enemyEspEnabled and Color3.fromRGB(200, 50, 50) or Color3.fromRGB(100, 100, 100)
        enemyEspButton.Text = enemyEspEnabled and "Êïå‰∫∫ESPÂºÄÂêØ" or "Êïå‰∫∫ESPÂÖ≥Èó≠"
        
        -- Êõ¥Êñ∞ÊâÄÊúâÊïå‰∫∫ESPÁöÑÊòæÁ§∫Áä∂ÊÄÅ
        for target, data in pairs(espCache) do
            if data.isEnemy then
                local shouldShow = shouldShowESP(target, data)
                if data.highlight then
                    data.highlight.Enabled = shouldShow
                end
                if data.billboard then
                    data.billboard.Enabled = shouldShow
                end
                if data.tracer then
                    data.tracer.Enabled = shouldShow
                end
            end
        end
    end)
    
    -- Â∫üÊñôESPÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
    trashEspButton.MouseButton1Click:Connect(function()
        trashEspEnabled = not trashEspEnabled
        
        trashEspButton.BackgroundColor3 = trashEspEnabled and Color3.fromRGB(50, 150, 255) or Color3.fromRGB(100, 100, 100)
        trashEspButton.Text = trashEspEnabled and "Â∫üÊñôESPÂºÄÂêØ" or "Â∫üÊñôESPÂÖ≥Èó≠"
        
        if not trashEspEnabled then
            -- Ê∏ÖÈô§ÊâÄÊúâÂ∫üÊñôÈ´ò‰∫Æ
            for trashPart, highlight in pairs(highlightedTrash) do
                if highlight then highlight:Destroy() end
                local label = trashPart:FindFirstChild("TrashLabel")
                if label then label:Destroy() end
                highlightedTrash[trashPart] = nil
            end
        else
            -- ÈáçÊñ∞Êâ´ÊèèÂ∫üÊñô
            task.spawn(fullScanTrash)
        end
    end)
    
    -- Â§úËßÜÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
    nightVisionToggleButton.MouseButton1Click:Connect(function()
        local newState = toggleNightVision()
        
        nightVisionToggleButton.BackgroundColor3 = newState and Color3.fromRGB(50, 200, 200) or Color3.fromRGB(100, 100, 150)
        nightVisionToggleButton.Text = newState and "Â§úËßÜÂºÄÂêØ" or "Â§úËßÜÂÖ≥Èó≠"
    end)
    
    -- ÊãñÊãΩÂäüËÉΩ
    local dragging
    local dragInput
    local dragStart
    local startPos
    
    local function update(input)
        local delta = input.Position - dragStart
        mainButton.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        buttonContainer.Position = UDim2.new(0.5, 0, 0.5, 0) -- ‰øùÊåÅÊåâÈíÆÂÆπÂô®Âú®Â±èÂπï‰∏≠ÂøÉ
    end
    
    mainButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = mainButton.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    mainButton.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
    
    return screenGui
end

-- ÂàõÂª∫ÂúÜÂΩ¢ËèúÂçï
createCircularMenu()

-- ÈªòËÆ§ÂêØÁî®Â§úËßÜ
enableNightVision()
print("Â§úËßÜÂäüËÉΩÂ∑≤ÈªòËÆ§ÂêØÁî®")
print("ÂúÜÂΩ¢ÊÇ¨ÊµÆËèúÂçïÂ∑≤ÂàõÂª∫ - ÁÇπÂáªÂè≥‰æßÁöÑNYÊåâÈíÆÂ±ïÂºÄÂäüËÉΩËèúÂçï")
print("Áé©ÂÆ∂ESP: " .. (playerEspEnabled and "ÂºÄÂêØ" or "ÂÖ≥Èó≠"))
print("Êïå‰∫∫ESP: " .. (enemyEspEnabled and "ÂºÄÂêØ" or "ÂÖ≥Èó≠"))
print("Â∫üÊñôESP: " .. (trashEspEnabled and "ÂºÄÂêØ" or "ÂÖ≥Èó≠"))
print("Âä†ÈÄüÂäüËÉΩ: " .. (isSpeeding and "ÂºÄÂêØ" or "ÂÖ≥Èó≠"))
print("‚úÖ Á≠âÂæÖÁªìÊùüÔºåÂºÄÂßãÊâßË°å‰∏ªËÑöÊú¨...")

-- Âú®ËøôÈáåÊãºÊé•‰Ω†ÁöÑ‰∏ªËÑöÊú¨
-- ‰Ω†ÁöÑ‰∏ªËÑöÊú¨ÂÜÖÂÆπ‰ªéËøôÈáåÂºÄÂßã...
-- ÊúçÂä°Âô®ËÑöÊú¨ÔºöÂú®ÊåáÂÆö‰ΩçÁΩÆÂàõÂª∫ÂÖ≠‰∏™Ê†áËÆ∞
-- Â∞ÜÊ≠§ËÑöÊú¨ÊîæÂú®ServerScriptService‰∏≠

local ServerStorage = game:GetService("ServerStorage")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

-- ÁõÆÊ†áÂùêÊ†á
local markerPositions = {
    watchtower = Vector3.new(48.06, 57.82, -46.03),   -- Áû≠ÊúõÂ°îÂùêÊ†á
    redhouse = Vector3.new(-36.38, 17.61, 200.02),    -- Á∫¢ÊàøÂùêÊ†á
    safehouse = Vector3.new(-359.93, 15.37, 69.19),   -- ÂÆâÂÖ®Â±ãÂùêÊ†á
    powerstation = Vector3.new(-308.60, 20.00, -208.13), -- ÂèëÁîµÁ´ôÂùêÊ†á
    store = Vector3.new(-25.96, 16.31, -252.33),      -- ÂïÜÂ∫óÂùêÊ†á
    rakenest = Vector3.new(-154.01, 19.84, 29.52)     -- RakeËÄÅÂ∑¢ÂùêÊ†á
}

local markerConfigs = {
    watchtower = {
        text = "Áû≠ÊúõÂ°î\n  ¬∑",
        color = Color3.fromRGB(170, 0, 255)  -- Á¥´Ëâ≤
    },
    redhouse = {
        text = "Á∫¢Êàø\n ¬∑",
        color = Color3.fromRGB(255, 50, 50)  -- ‰∫ÆÁ∫¢Ëâ≤
    },
    safehouse = {
        text = "ÂÆâÂÖ®Â±ã\n  ¬∑",
        color = Color3.fromRGB(50, 255, 50)  -- ÁªøËâ≤
    },
    powerstation = {
        text = "ÂèëÁîµÁ´ô\n  ¬∑",
        color = Color3.fromRGB(139, 69, 19)  -- Ê£ïËâ≤
    },
    store = {
        text = "ÂïÜÂ∫ó\n ¬∑",
        color = Color3.fromRGB(0, 100, 255)  -- ËìùËâ≤
    },
    rakenest = {
        text = "RakeËÄÅÂ∑¢\n   ¬∑",
        color = Color3.fromRGB(255, 255, 0)  -- ÈªÑËâ≤
    }
}

local markers = {}

-- ÂàõÂª∫Ê†áËÆ∞ÂáΩÊï∞
local function createMarker(position, text, color)
    -- ÂàõÂª∫ÂπøÂëäÁâåGUIÁöÑÂÆπÂô®
    local part = Instance.new("Part")
    part.Anchored = true
    part.CanCollide = false
    part.Transparency = 1  -- ÂÆåÂÖ®ÈÄèÊòéÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÂÆÉÁöÑ‰ΩçÁΩÆ
    part.Size = Vector3.new(2, 2, 2)
    part.Position = position
    part.Parent = workspace
    
    -- ÂàõÂª∫ÂπøÂëäÁâåGUI
    local billboard = Instance.new("BillboardGui")
    billboard.Adornee = part
    billboard.Size = UDim2.new(0, 200, 0, 80)
    billboard.StudsOffset = Vector3.new(0, 3, 0)  -- Âú®ÈÉ®‰ª∂‰∏äÊñπÊòæÁ§∫
    billboard.AlwaysOnTop = true
    
    -- ÂàõÂª∫ÊñáÊú¨Ê†áÁ≠æ
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.Font = Enum.Font.SourceSansBold
    label.TextColor3 = color
    label.TextSize = 24
    label.TextStrokeTransparency = 0.8  -- ÊñáÂ≠óÊèèËæπÔºå‰ΩøÂÖ∂Âú®ÂêÑÁßçËÉåÊôØ‰∏ãÈÉΩÊ∏ÖÊô∞ÂèØËßÅ
    label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    label.Parent = billboard
    
    billboard.Parent = part
    
    return part
end

-- ÂàõÂª∫ÊâÄÊúâÊ†áËÆ∞
for markerType, position in pairs(markerPositions) do
    markers[markerType] = createMarker(
        position, 
        markerConfigs[markerType].text, 
        markerConfigs[markerType].color
    )
end

-- ÂΩìÁé©ÂÆ∂Âä†ÂÖ•Êó∂ÔºåÁ°Æ‰øù‰ªñ‰ª¨ËÉΩÁúãÂà∞ÊâÄÊúâÊ†áËÆ∞
Players.PlayerAdded:Connect(function(player)
    -- ÂΩìÊñ∞Áé©ÂÆ∂Âä†ÂÖ•Êó∂ÔºåÁ°Æ‰øùÊ†áËÆ∞ÂØπ‰ªñ‰ª¨ÂèØËßÅ
    for markerType, position in pairs(markerPositions) do
        if not markers[markerType] or not markers[markerType].Parent then
            markers[markerType] = createMarker(
                position, 
                markerConfigs[markerType].text, 
                markerConfigs[markerType].color
            )
        end
    end
end)

-- ÂèØÈÄâÔºöÊ∑ªÂä†‰∏Ä‰∏™ËøúÁ®ã‰∫ã‰ª∂Ôºå‰ª•‰æøÂÆ¢Êà∑Á´ØÂèØ‰ª•ËØ∑Ê±ÇÊõ¥Êñ∞Ê†áËÆ∞‰ΩçÁΩÆ
local updateMarkerEvent = Instance.new("RemoteEvent")
updateMarkerEvent.Name = "UpdateLocationMarker"
updateMarkerEvent.Parent = ReplicatedStorage

updateMarkerEvent.OnServerEvent:Connect(function(player, markerType, newPosition)
    -- ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÊùÉÈôêÊ£ÄÊü•Ôºå‰æãÂ¶ÇÂè™ÂÖÅËÆ∏ÁÆ°ÁêÜÂëòÊõ¥Êñ∞‰ΩçÁΩÆ
    if markers[markerType] then
        markers[markerType]:Destroy()
    end
    markerPositions[markerType] = newPosition
    markers[markerType] = createMarker(
        newPosition, 
        markerConfigs[markerType].text, 
        markerConfigs[markerType].color
    )
end)

-- Ê∑ªÂä†Ê†áËÆ∞ÂèØËßÅÊÄßÊéßÂà∂
local markerVisibility = {
    watchtower = true,
    redhouse = true,
    safehouse = true,
    powerstation = true,
    store = true,
    rakenest = true
}

local function setMarkerVisibility(markerType, visible)
    if markers[markerType] then
        markers[markerType].BillboardGui.Enabled = visible
        markerVisibility[markerType] = visible
    end
end

-- Ê∑ªÂä†ËøúÁ®ã‰∫ã‰ª∂Êù•ÊéßÂà∂ÂèØËßÅÊÄß
local toggleVisibilityEvent = Instance.new("RemoteEvent")
toggleVisibilityEvent.Name = "ToggleMarkerVisibility"
toggleVisibilityEvent.Parent = ReplicatedStorage

toggleVisibilityEvent.OnServerEvent:Connect(function(player, markerType)
    if markerVisibility[markerType] ~= nil then
        setMarkerVisibility(markerType, not markerVisibility[markerType])
    end
end)

-- ËøîÂõûÊ†áËÆ∞ÂØπË±°Ôºå‰ª•‰æøÂÖ∂‰ªñËÑöÊú¨ÂèØ‰ª•‰ΩøÁî®
return {
    Markers = markers,
    Positions = markerPositions,
    UpdatePosition = function(markerType, newPosition)
        if markers[markerType] then
            markers[markerType]:Destroy()
        end
        markerPositions[markerType] = newPosition
        markers[markerType] = createMarker(
            newPosition, 
            markerConfigs[markerType].text, 
            markerConfigs[markerType].color
        )
    end,
    AddMarker = function(markerType, position, text, color)
        if markers[markerType] then
            markers[markerType]:Destroy()
        end
        markerPositions[markerType] = position
        markerConfigs[markerType] = {
            text = text,
            color = color
        }
        markers[markerType] = createMarker(position, text, color)
    end,
    RemoveMarker = function(markerType)
        if markers[markerType] then
            markers[markerType]:Destroy()
            markers[markerType] = nil
            markerPositions[markerType] = nil
            markerConfigs[markerType] = nil
        end
    end,
    SetVisibility = setMarkerVisibility,
    ToggleVisibility = function(markerType)
        if markerVisibility[markerType] ~= nil then
            setMarkerVisibility(markerType, not markerVisibility[markerType])
        end
    end,
    GetAllMarkersInfo = function()
        local info = {}
        for markerType, _ in pairs(markerPositions) do
            info[markerType] = {
                position = markerPositions[markerType],
                text = markerConfigs[markerType].text,
                color = markerConfigs[markerType].color,
                visible = markerVisibility[markerType]
            }
        end
        return info
    end
}